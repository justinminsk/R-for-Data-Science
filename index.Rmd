---
title: "R for Data Science"
author: "Justin Minsk"
date: "September 1, 2017"
output: html_document
---

## Purpose

This site is to play with the Rmarkdown platform more using the code and data from R for Data Science by Hadley Wickman and Garrett Grolemund.

##Data Visulzation

The package I am using for ggplots2 and dyplr.
```{r message=FALSE, warning=FALSE}
library(tidyverse)
```
###Chapter one
First set of data.
```{r}
mpg
```
Some different graphs using ggplots.
```{r message=FALSE, warning=FALSE}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, color = class)) 

#Basic point plot with color shows the engine type and highway milage the car gets and also what type of car it is with color

ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class)) +
  geom_smooth() 

#adds a line of best fit showing that highway mileage lowers with the amount of cylinders 

ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_wrap(~ class, nrow = 2)

#breaks data into different graphs based on the class of car

ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class)) +
  geom_smooth(
    data = filter(mpg, class == "subcompact"),
    se = FALSE
  )

#the smooth line now only is based off of the subcompact car class
```
###Chapter Two
Second set of data
```{r}
diamonds
```
Examples of graphs using ggplots
```{r message=FALSE, warning=FALSE}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut)) 
#creates a basic bar graph

ggplot(data = diamonds) +
  stat_count(mapping = aes(x = cut))
#makes the same bar graph different code

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, y = ..prop.., group = 1))
#makes a bar graph of proportions rather than bulk numbers

ggplot(data = diamonds) +
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  )
#makes a box graph here comparing cut and depth they are found at

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, color = cut, fill = cut))
#color adds an outline, fill fills thebars a color

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = clarity))
#if you use a second varible will fill the bars in proportion to the bar, here cut broken down into clarity

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = clarity),
  position = "fill"
  )
#makes the bars even but shows proportion of cut compared to clarity better

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = clarity),
           position = "dodge"
  )
#makes seprate bars to better show numbers over proportions

ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy), postion = "jitter")
#makes it so each point is represented, but with loss of accuracy


ggplot(data = mpg, mapping = aes(x = class, y = hwy)) +
  geom_boxplot() +
  coord_flip()
#makes a box plot of class compared to highway milage, coord_flip() flips the axis
```


##Data Transformation
Note that the veiw() command will not open a window in the browser, but in Rstudio it will open a seprate window to veiw all of the data. 

###Chapter Three

Use this package for the dataset that will be used
```{r message=FALSE, warning=FALSE}
library(nycflights13)
```
The data set shown in table format two different ways
```{r}
nycflights13::flights
#our data set

View(flights)
#opens a window so you can see all the data not just an example 
```
Some examples of the filter command
```{r}
filter(flights, month == 1, day == 1)
#filters the data by first month first day only

(jan1 <- filter(flights, month == 1, day == 1))
#saves that filter into varible jan1

nov_dec <- filter(flights, month %in% c(11, 12))
#assigns all of the nov and dec flights into a table

View(nov_dec)
#test to see that it does
```
Some examples of arrange command
```{r}
View(arrange(flights, year, month, day))
#arranges from low to high by year, month, and day

arrange(flights, desc(arr_delay))
#aranges from high to low the delay, note na or no vaule data points are moved to the end
```
Some examples of select command
```{r}
select(flights, year, month, day)
#selects only certain columns, can use for example (year:day) all columns between two columns or -(year:day) to
#selects everything but the columns you specifiy in this example day, month, and year
#select also uses common string functions like contains, starts_with, etc.

flights_sml <- select(flights, year:day, ends_with("delay"), distance, air_time)
#makes a sample set of day, month, year, all delay sets, distance, and air time

```
Some examples of mutate command
```{r}
mutate(flights_sml, gain = arr_delay - dep_delay, speed = distance / air_time * 60)
#creates columns for gain and speed based off of our parameters

transmute(flights, gain = arr_delay - dep_delay, hours = air_time / 60, gain_per_hour = gain/hours )
#only keeps new varibles that you create using your parameters

```
Some basic commands
```{r}
x <- 1:10
#make x 1-10
lag(x)
#looks at x from one spot the the left so NA to 9 instead
lead(x)
#looks at x from one spot the the right so 2 to NA instead
cumsum(x)
#adds all values
cummean(x)
#finds rolling mean
min_rank(x)
#ranks from smallest to largest 

```
Some examples of using these commands in tandum 
```{r message=FALSE, warning=FALSE}
by_day <- group_by(flights, year, month, day)
#group by_day in flights by year, month, day
summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
#finds the mean delay for a day exculding NA's

by_dest <- group_by(flights, dest)
delay <- summarize(by_dest, count = n(), dist = mean(distance, na.rm = TRUE), delay = mean(arr_delay, na.rm = TRUE))
delay <- filter(delay, count > 20, dest != "HNL")
ggplot(data = delay, mapping = aes(x = dist, y = delay)) +
  geom_point(aes(size = count), alpha = 1/3) +
  geom_smooth(se = FALSE)
#groups flights by destionation, summarizes to coute distance, average delay, and # of flights
#filter to remove short flights and honolulu since it is an outliear

delays <- flights %>%
  group_by(dest) %>%
  summarize(count = n(), dist = mean(distance, na.ra = TRUE), delay = mean(arr_delay, na.ra = TRUE)) %>%
  filter(count > 20, dest != "HNL")
#%>% means or can be thought of as then so create a varible based on our data THEN group the data by destionation
#THEN create a summary with a count and dist as a mean of the distances and delay as the mean of delays from short to highest
#THEN filter out our short flights and Honolulu since it is an outliear

```

##EDA

###Preface
Now we are using some of our skills to do some baseline anyalitics on the data. This will be done often by using histograms and finding "odd" data and/or looking for trends to hone in on. Then using filters and sorters to look at the data and find insight.


###Chapter 4

Starting with some examples from the book.

```{r}
library(tidyverse)

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut))
#an example of a categorical data point

diamonds %>%
  count(cut)
#gives the raw numbers for each bar

ggplot(data = diamonds) +
  geom_histogram(mapping = aes(x = carat), binwidth = 0.5)
#an example of a continusous data point graphed

diamonds %>%
  count(cut_width(carat, 0.5))
#gives raw numbers in a 0.5 carat width

smaller <- diamonds %>%
  filter(carat < 3)
#create a varible of diamonds with a carat less than 3

ggplot(data = smaller, mapping = aes(x = carat)) +
  geom_histogram(binwidth = 0.1)
#since our largest set of data is betwen 0.25 and 0.75 looking at data around that with a larger breakdown
#of 0.1 instead of 0.5 

ggplot(data = smaller, mapping = aes(x = carat, color = cut)) +
  geom_freqpoly(binwidth = 0.1)
#shows the same as above but with cut also shown in color so that you can see a breakdown of cut and carat

ggplot(diamonds) +
  geom_histogram(mapping = aes(x = y), binwidth = 0.5)
#create a graph of common observations, the problem is that we cannot see the outliears in this graph

ggplot(diamonds) +
  geom_histogram(mapping = aes(x = y), binwidth = 0.5) +
  coord_cartesian(ylim = c(0, 50))
#zooms into the yaxis to see the rare "bins" of data using coord_cartesian

unusual <- diamonds %>%
  filter(y < 3 | y > 20) %>%
  arrange(y)
#create a dara set of unusual data aka the data less then 3 and greater than 20 on the y axis

unusual
#as you can see there are some diamonds with 0's in x and y which y is a width and diamonds cannot 
#have a width of 0 also they cannot have a width of 31.8 or 58.9 mm which is almost over an inch long

```

###Exploration

Now the start of using some of the ideas from the book. By asking and answering questions and looking at the data.

```{r}
ggplot(diamonds) +
  geom_histogram(mapping = aes(x = price), binwidth = 1000) 
#here is a histogram based on price and as you can see there are some odd data points like the price being
#below 0

ggplot(diamonds) +
  geom_histogram(mapping = aes(x = price), binwidth = 100) +
  coord_cartesian(xlim = c(-1000, 1000))
#using a coord_cartesian we can see that while on the histogram it looks like there are points below 0
#in fact there are not now to look at the upper end

ggplot(diamonds) +
  geom_histogram(mapping = aes(x = price), binwidth = 100) +
  coord_cartesian(xlim = c(15000, 30000))
#here we can see that diamonds drop off before 20000 in price


ggplot(diamonds) +
  geom_histogram(mapping = aes(x = price), binwidth = 100) +
  coord_cartesian(xlim = c(300, 1400))
#here is the spike in out data

spike <- diamonds %>%
  filter(between(price, 300, 1400)) %>%
  arrange(price)
#narrow our window

spike

spike %>%
  count(cut_width(price, 100))
#look at where the bulk of the data lies

spike2 <- spike %>%
  filter(between(price, 600, 800))
#narrow even more

spike2

ggplot(spike2) +
  geom_bar(mapping = aes(x = carat, color = cut, fill = cut))
#see what carat and cut diamonds are selling for in this 200 dollar range 
#can see that the bulk of diamonds are sold around 600-800 dollars and are ideal cut 0.3-0.35 carat diamonds

highcarat <- spike2 %>%
  filter(between(carat, 0.4, 0.41)) %>%
  arrange(price)
#want to look at the bumb around 0.4 carats

ggplot(highcarat) +
  geom_boxplot(mapping = aes(y = price, x = cut))
#this seems to show in the 0.4 - 0.41 carat range premium seems to sell for the most and ideal 
#has some of the lowest selling diamonds which is odd

highcarat %>%
  count(cut)

highcarat %>%
  count(cut_width(price, 50))
#looking at what the data has in terms of numbers for cut and price
#since we are looking at price looks like price is a good data set to hone into

highcarat2 <- highcarat %>%
  filter(between(price, 675, 725))
#looking at our largest amount of data in this price point

ggplot(highcarat2) +
  geom_boxplot(mapping = aes(y = price, x = cut))
#oddly the worst cut diamonds seem to be sold for more than the other cuts, while premium has a large range

ggplot(highcarat2) +
  geom_boxplot(mapping = aes(y = y, x = cut))
#most of the y socres are around the same minus the fair diamons

ggplot(spike2) +
  geom_boxplot(mapping = aes(y = y, x = cut))
#this is more even for the price between 600- 800 and makes more sense with fair needing higher y
#scores then premium or ideal
#this might just be an outliear unless found else where it shows little possibly because I want to narrow in my net
```

###Back to chapter 4


